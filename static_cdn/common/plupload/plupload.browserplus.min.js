(function(b){b.runtimes.BrowserPlus=b.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:true,jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(l,j){var n=window.BrowserPlus,k={},o=l.settings,p=o.resize;function m(h){var c,d,f=[],e,g;for(d=0;d<h.length;d++){e=h[d];g=b.guid();k[g]=e;f.push(new b.File(g,e.name,e.size))}if(d){l.trigger("FilesAdded",f)}}function a(){var c=false;l.bind("PostInit",function(){var r,e=o.drop_element,h=l.id+"_droptarget",f=document.getElementById(e),d;function g(q,t){n.DragAndDrop.AddDropTarget({id:q},function(s){n.DragAndDrop.AttachCallbacks({id:q,hover:function(v){if(!v&&t){t()}},drop:function(v){if(t){t()}m(v)}},function(){})})}function i(){document.getElementById(h).style.top="-1000px"}if(f){if(document.attachEvent&&(/MSIE/gi).test(navigator.userAgent)){r=document.createElement("div");r.setAttribute("id",h);b.extend(r.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0});document.body.appendChild(r);b.addEvent(f,"dragenter",function(u){var v,q;v=document.getElementById(e);q=b.getPos(v);b.extend(document.getElementById(h).style,{top:q.y+"px",left:q.x+"px",width:v.offsetWidth+"px",height:v.offsetHeight+"px"})});g(h,i)}else{g(e)}}b.addEvent(document.getElementById(o.browse_button),"click",function(q){var D=[],B,C,y=o.filters,z,A;q.preventDefault();if(c){return}no_type_restriction:for(B=0;B<y.length;B++){z=y[B].extensions.split(",");for(C=0;C<z.length;C++){if(z[C]==="*"){D=[];break no_type_restriction}A=b.mimeTypes[z[C]];if(A&&b.inArray(A,D)===-1){D.push(b.mimeTypes[z[C]])}}}n.FileBrowse.OpenBrowseDialog({mimeTypes:D},function(s){if(s.success){m(s.value)}})});f=r=null});l.bind("CancelUpload",function(){n.Uploader.cancel({},function(){})});l.bind("DisableBrowse",function(e,d){c=d});l.bind("UploadFile",function(h,u){var i=k[u.id],v={},t=h.settings.chunk_size,g,f=[];function d(s,q){var r;if(u.status==b.FAILED){return}v.name=u.target_name||u.name;if(t){v.chunk=""+s;v.chunks=""+q}r=f.shift();n.Uploader.upload({url:h.settings.url,files:{file:r},cookies:document.cookies,postvars:b.extend(v,h.settings.multipart_params),progressCallback:function(B){var z,A=0;g[s]=parseInt(B.filePercent*r.size/100,10);for(z=0;z<g.length;z++){A+=g[z]}u.loaded=A;h.trigger("UploadProgress",u)}},function(z){var A,B;if(z.success){A=z.value.statusCode;if(t){h.trigger("ChunkUploaded",u,{chunk:s,chunks:q,response:z.value.body,status:A})}if(f.length>0){d(++s,q)}else{u.status=b.DONE;h.trigger("FileUploaded",u,{response:z.value.body,status:A});if(A>=400){h.trigger("Error",{code:b.HTTP_ERROR,message:b.translate("HTTP Error."),file:u,status:A})}}}else{h.trigger("Error",{code:b.GENERIC_ERROR,message:b.translate("Generic Error."),file:u,details:z.error})}})}function e(q){u.size=q.size;if(t){n.FileAccess.chunk({file:q,chunkSize:t},function(s){if(s.success){var r=s.value,z=r.length;g=Array(z);for(var y=0;y<z;y++){g[y]=0;f.push(r[y])}d(0,z)}})}else{g=Array(1);f.push(q);d(0,1)}}if(p&&/\.(png|jpg|jpeg)$/i.test(u.name)){BrowserPlus.ImageAlter.transform({file:i,quality:p.quality||90,actions:[{scale:{maxwidth:p.width,maxheight:p.height}}]},function(q){if(q.success){e(q.value.file)}})}else{e(i)}});j({success:true})}if(n){n.init(function(c){var d=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];if(p){d.push({service:"ImageAlter",version:"4"})}if(c.success){n.require({services:d},function(e){if(e.success){a()}else{j()}})}else{j()}})}else{j()}}})})(plupload);